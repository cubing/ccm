<head>
  <title>live.cubing.net</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- generated by http://realfavicongenerator.net/ -->
  <link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/img/favicon/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/img/favicon/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/img/favicon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/img/favicon/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/img/favicon/manifest.json">
  <link rel="shortcut icon" href="/img/favicon/favicon.ico">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/img/favicon/mstile-144x144.png">
  <meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
</head>

<template name="layout">
  {{setDocumentTitle}}

  {{> connectionBanner}}

  <nav class="navbar navbar-default navbar-plain-rectangle" role="navigation">
    {{#ccmModal id="modal-verificationsent"}}
      <div class="modal-body">
        {{#if verificationSendSuccess}}
          <p>Verification email sent</p>
        {{else}}
          <p>Encountered error while sending verification email.</p>
        {{/if}}
      </div>
      <div class="modal-footer">
        {{> ccmCancelButton}}
      </div>
    {{/ccmModal}}

    <div class="container-fluid">
      {{!-- Brand and toggle get grouped for better mobile display --}}
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <ul class="nav navbar-nav navbar-brand">
          <li class="{{#if isActiveRoute 'home'}}active{{/if}} leaf">
            <a href="{{pathFor 'home'}}">
              <img alt="CCM" src="/img/ccm_logo.svg">
            </a>
          </li>

          {{#if competitionId}}
            <li class="{{#if isActiveOrAncestorRoute 'competition'}}active{{/if}}" id="competition-name">
              <a href="{{pathFor 'competition'}}">{{competitionAttr 'competitionName'}}</a>
            </li>
            {{#if currentUser}}
              {{#if canManageCompetition currentUser._id}}
                <li class="{{#if isActiveOrAncestorRoute 'manageCompetition'}}active{{/if}}">
                  <a href="{{pathFor 'manageCompetition'}}"><i class="fa fa-cogs"></i></a>
                </li>
              {{/if}}
            {{/if}}
          {{/if}}
        </ul>
      </div>

      {{!-- Collect the nav links, forms, and other content for toggling --}}
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          {{#if currentUser}}
            {{#with newCompetitionTab}}
              {{> oneTab}}
            {{/with}}
          {{/if}}
          {{#if currentUser}}
            {{> loginButtons}}
          {{else}}
            <li>
              {{> loginButtons}}
            </li>
            {{!-- Modified version of Template._loginButtonsLoggedOutDropdown --}}
            <li id="login-dropdown-list" class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown"><b class="caret"></b></a>
              <div class="dropdown-menu">
                {{> _loginButtonsLoggedOutAllServices}}
              </div>
            </li>
          {{/if}}
        </ul>
      </div> {{!-- /.navbar-collapse --}}
    </div> {{!-- /.container-fluid --}}
  </nav>

  {{#if isActiveOrAncestorRoute 'competition'}}
    {{#navBar}}
      {{#each userTabs}}
        {{> oneTab}}
      {{/each}}
    {{/navBar}}
  {{/if}}

  {{#if isActiveOrAncestorRoute 'manageCompetition'}}
    {{#navBar}}
      {{#each managerTabs}}
        {{> oneTab}}
      {{/each}}
    {{/navBar}}
  {{/if}}

  {{#if isActiveOrAncestorRoute 'scrambles'}}
    {{#navBar}}
      {{#each scrambleTabs}}
        {{> oneTab}}
      {{/each}}
    {{/navBar}}
  {{/if}}

  {{#if isActiveOrAncestorRoute 'podiums'}}
    {{#navBar}}
      {{#each podiumTabs}}
        {{> oneTab}}
      {{/each}}
    {{/navBar}}
  {{/if}}

  {{> yield}}

  <footer class="footer">
    <div class="container">
      <p class="text-muted">Powered by <a target="_blank" href="https://github.com/cubing/ccm">CCM</a></p>
    </div>
  </footer>
</template>

<!-- see https://github.com/ianmartorell/meteor-accounts-ui-bootstrap-3/#add-additional-logged-in-actions -->
<template name="_loginButtonsAdditionalLoggedInDropdownActions">
  <p class="text-center">
    <a href="{{pathFor 'editProfile'}}">Your profile</a>
  </p>
  {{#if currentUser.siteAdmin}}
    <p class="text-center">
      <a href="{{pathFor 'administerSite'}}">Administer site</a>
    </p>
  {{/if}}

  {{#if currentUser}}
    {{#unless currentUser.emails.[0].verified}}
      <button class="btn btn-danger btn-block" id="login-buttons-resend-emailverification"
              data-toggle="tooltip" data-placement="bottom" data-container="body"
              title="Your email address has not yet been verified">
        Resend verification email
      </button>
    {{/unless}}
  {{/if}}
</template>

<template name="navBar">
  <nav class="navbar navbar-default navbar-plain-rectangle" role="navigation">
    <div class="container-fluid">
      <div class="navbar-collapse collapse-buttons">
        <ul class="nav navbar-nav navbar-left">
          {{> Template.contentBlock}}
        </ul>
      </div>
    </div>
  </nav>
</template>

<template name="oneTab">
  <li class="{{active}} {{otherClass}} {{leaf}}">
    <a href="{{pathFor route=route data=parentData}}"
       data-toggle="tooltip" data-placement="bottom" data-container="body" title="{{title}}">
      {{#if img}}
        <img src="{{icon}}"/>
      {{else}}
        <span class="{{icon}}"></span>
      {{/if}}
      <span class="hidden-xs">{{text}}</span>
    </a>
  </li>
</template>

